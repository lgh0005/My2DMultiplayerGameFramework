#include "pch.h"
#include "InputManager.h"

void InputManager::Update()
{
	for (auto& state : _keyboardState)
	{
		if (state == InputState::Down) state = InputState::Press;
		else if (state == InputState::Up) state = InputState::None;
	}

	for (auto& state : _mouseState)
	{
		if (state == InputState::Down) state = InputState::Press;
		else if (state == InputState::Up) state = InputState::None;
	}
}

void InputManager::GetEvent(const SDL_Event& e)
{
	switch (e.type)
	{
	// Keyboard
	case SDL_KEYDOWN:
	case SDL_KEYUP:
	{
		SDL_Scancode scancode = e.key.keysym.scancode;
		InputState& state = _keyboardState[scancode];

		if (e.type == SDL_KEYDOWN)
		{
			if (state == InputState::Press || state == InputState::Down)
				state = InputState::Press;
			else
				state = InputState::Down;
		}
		else // SDL_KEYUP
		{
			if (state == InputState::Press || state == InputState::Down)
				state = InputState::Up;
			else
				state = InputState::None;
		}
		break;
	}

	// Mouse
	case SDL_MOUSEBUTTONDOWN:
	case SDL_MOUSEBUTTONUP:
	{
		int button = e.button.button;
		if (button < SDL_BUTTON_LEFT || button > SDL_BUTTON_X2) break;
		InputState& state = _mouseState[button];

		if (e.type == SDL_MOUSEBUTTONDOWN)
		{
			if (state == InputState::Press || state == InputState::Down)
				state = InputState::Press;
			else
				state = InputState::Down;
		}
		else // SDL_MOUSEBUTTONUP
		{
			if (state == InputState::Press || state == InputState::Down)
				state = InputState::Up;
			else
				state = InputState::None;
		}
		break;
	}
	}
}
